(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.angularRadialColorPicker=b()})(this,function(){'use strict';function a(a){function b(a,c,d){return(16777216+(a<<16)+(c<<8)+d).toString(16).slice(1)}function c(a,c,e){var f,h,g;if(a/=360,c/=100,e/=100,0===c)f=h=g=e;else{var b=0.5>e?e*(1+c):e+c-e*c,j=2*e-b;f=d(j,b,a+1/3),h=d(j,b,a),g=d(j,b,a-1/3)}return{red:i(255*f),green:i(255*h),blue:i(255*g)}}function d(a,b,c){return 0>c&&(c+=1),1<c&&(c-=1),c<1/6?a+6*(b-a)*c:c<1/2?b:c<2/3?a+6*((b-a)*(2/3-c)):a}this.publish=function(b,c){a.$applyAsync(function(){a.$broadcast(f+b,c)})},this.subscribe=function(b,c){var d=a.$on(f+b,c);return e.push(d),d},this.unsubscribe=function(){e.forEach(function(a){a()})},this.isKey={up:function(a){return'Up'===a||'ArrowUp'===a},down:function(a){return'Down'===a||'ArrowDown'===a},left:function(a){return'Left'===a||'ArrowLeft'===a},right:function(a){return'Right'===a||'ArrowRight'===a},enter:function(a){return'Enter'===a}},this.rgbToHex=b,this.rgbToHsl=function(a,c,e){a/=255,c/=255,e/=255;var b,f,g=Math.max(a,c,e),h=j(a,c,e),i=(g+h)/2;if(g===h)b=f=0;else{var k=g-h;f=0.5<i?k/(2-g-h):k/(g+h),g===a&&(b=(c-e)/k+(c<e?6:0)),g===c&&(b=(e-a)/k+2),g===e&&(b=(a-c)/k+4)}return{hue:60*b,saturation:100*f,luminosity:100*i}},this.hslToRgb=c,this.hslToHex=function(a,d,e){var f=c(a,d,e);return b(f.red,f.green,f.blue)};var e=[],f='color-picker.'}function b(a,b){this.last=0,this.active=!1,this.element=a,this.update=this.update.bind(this),this.initAngleGetterSetter(),this.initOptions(b),this.initHardwareAcceleration(),this.bindHandlers(),this.addListeners(),this.update()}function c(a){return{link:function(c,d){function e(b){if(!c.isDisabled){var d=0,e=a.isKey.up(b.key)||a.isKey.right(b.key),f=a.isKey.down(b.key)||a.isKey.left(b.key);e?(d=1,b.ctrlKey?d=6:b.shiftKey&&(d=3)):f&&(d=-1,b.ctrlKey?d=-6:b.shiftKey&&(d=-3)),(e||f)&&(b.preventDefault(),k.angle+=i*d)}}function f(a){if(!c.isDisabled&&a.target.classList.contains('rotator')){var d=k.getAngleToMouse({x:a.clientX,y:a.clientY});k.angle=d*b.radToDegMulti}}function g(a){c.isDisabled||(a.preventDefault(),0<a.deltaY?k.angle+=i:k.angle-=i)}var h=d[0].parentElement,i=c.scrollSensitivity||2,j=c.angle||0,k=new b(d[0],{angle:j,inertia:.7,speed:0,onRotate:function(){c.onRotate({angle:this.angle})},onDragStart:function(){c.isDisabled||d.addClass('dragging')},onDragStop:function(){c.isDisabled||d.removeClass('dragging')}});h.addEventListener('keydown',e),h.addEventListener('dblclick',f,{passive:!0}),c.mouseScroll&&h.addEventListener('wheel',g),c.$watch('angle',function(a,b){a!==b&&(k.angle=a)}),c.$on('$destroy',function(){k.stop(),k.unbind(),k=null,h.removeEventListener('keydown',e),h.removeEventListener('dblclick',f),h.removeEventListener('wheel',g),h=null})},restrict:'A',scope:{onRotate:'&',angle:'<',isDisabled:'<',mouseScroll:'<',scrollSensitivity:'<'}}}function d(a){this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('2d'),this.size=a,this.canvas.width=this.canvas.height=this.size,this.from=0,this.stops=[{color:[255,0,0,1],pos:0},{color:[255,255,0,1],pos:0.16666666666666666},{color:[0,255,0,1],pos:0.33333333333333337},{color:[0,255,255,1],pos:0.5},{color:[0,0,255,1],pos:0.6666666666666666},{color:[255,0,255,1],pos:0.8333333333333333},{color:[255,0,0,1],pos:1}],this.paint()}function e(a,b,c){function d(){n.classList.add('click-color'),k.disabled?(c.publish('show',k.colorModel),p.classList.add('blur-palette-in'),p.classList.remove('blur-palette-out')):(c.publish('selected',k.colorModel),k.onSelect({color:k.colorModel}),c.publish('hide',k.colorModel),o.classList.add('color-shadow-animate'))}function e(a){c.isKey.enter(a.key)&&d()}function f(a){var b='';k.color?(k.color.hue=a,b='hsla('+k.color.hue+', '+k.color.saturation+'%, '+k.color.luminosity+'%, '+k.color.alpha+')',k.colorModel=k.color):(b='hsla('+a+', 100%, 50%, 1)',k.colorModel={hue:a,saturation:100,luminosity:50,alpha:1}),n.style.backgroundColor=b,o.style.borderColor=b}function g(){k.disabled?(m.classList.add('zoom-knob-in'),m.classList.remove('zoom-knob-out')):(m.classList.add('zoom-knob-out'),m.classList.remove('zoom-knob-in')),n.classList.remove('click-color')}function h(a){'transform'===a.propertyName&&(k.disabled?(k.disabled=!1,l.classList.remove('disabled'),c.publish('shown',k.colorModel)):(p.classList.add('blur-palette-out'),p.classList.remove('blur-palette-in')))}function i(){o.classList.remove('color-shadow-animate')}function j(a){'transform'===a.propertyName&&(k.disabled?(m.classList.add('zoom-knob-in'),m.classList.remove('zoom-knob-out')):(k.disabled=!0,l.classList.add('disabled'),c.publish('hidden',k.colorModel)))}var k=this;this.disabled=!1,this.colorModel={hue:0,saturation:100,luminosity:50,alpha:1},this.$onInit=function(){l=a[0],m=l.querySelector('.knob'),n=l.querySelector('.color'),o=l.querySelector('.color-shadow'),p=l.querySelector('.color-palette'),l.addEventListener('keyup',e),n.addEventListener('animationend',g),m.addEventListener('transitionend',h),o.addEventListener('animationend',i),p.addEventListener('transitionend',j),l.setAttribute('tabindex',0),k.color&&k.color.hue?(k.angle=k.color.hue,f(k.color.hue)):k.angle=0},this.$onDestroy=function(){l.removeEventListener('keyup',e),n.removeEventListener('animationend',g),m.removeEventListener('transitionend',h),o.removeEventListener('animationend',i),p.removeEventListener('transitionend',j),m=null,l=null,n=null,o=null,p=null,c.unsubscribe()},this.$onChanges=function(a){a.color&&n&&o&&(k.angle=k.color.hue,f(k.color.hue))},this.onColorSelClick=d,this.onRotatorDrag=function(a){k.angle=a,f(a),b.$applyAsync(function(){k.onColorChange({color:k.colorModel})})};var l,m,n,o,p;c.subscribe('open',function(){k.disabled&&(c.publish('show',k.colorModel),p.classList.add('blur-palette-in'),p.classList.remove('blur-palette-out'))}),c.subscribe('close',function(){k.disabled||(c.publish('hide',k.colorModel),m.classList.add('zoom-knob-out'),m.classList.remove('zoom-knob-in'))})}var f=Math.atan2,g=Math.abs,i=Math.round,j=Math.min;a.$inject=['$rootScope'],b.prototype.initAngleGetterSetter=function(){Object.defineProperty(this,'angle',{get:function(){return this.normalizeAngle(this._angle*b.radToDegMulti)},set:function(a){var c=a*b.degToRadMulti;this._angle=c,this.virtualAngle=c,this.updateCSS()}})},b.prototype.normalizeAngle=function(a){var b=a%360;return 0>b&&(b=360+b),b},b.prototype.initOptions=function(a){var c={angle:0,speed:0,inertia:0,minimalSpeed:0.0087,minimalAngleChange:0.0087};a=a||c,this.onRotate=a.onRotate,this.onStop=a.onStop,this.onDragStop=a.onDragStop,this.onDragStart=a.onDragStart,this.angle=a.angle||c.angle,this.speed=a.speed*b.degToRadMulti||c.speed,this.inertia=a.inertia||c.inertia,this.minimalSpeed=a.minimalSpeed||c.minimalSpeed,this.lastAppliedAngle=this.virtualAngle=this._angle=a.angle*b.degToRadMulti||c.angle,this.minimalAngleChange=a.minimalAngleChange||c.minimalAngleChange},b.prototype.bindHandlers=function(){this.onRotationStart=this.onRotationStart.bind(this),this.onRotationStop=this.onRotationStop.bind(this),this.onRotated=this.onRotated.bind(this)},b.prototype.addListeners=function(){this.listenersInstalled=!0,this.element.addEventListener('touchstart',this.onRotationStart,{passive:!0}),this.element.addEventListener('touchmove',this.onRotated),this.element.addEventListener('touchend',this.onRotationStop,{passive:!0}),this.element.addEventListener('touchcancel',this.onRotationStop,{passive:!0}),this.element.addEventListener('mousedown',this.onRotationStart,{passive:!0}),this.element.addEventListener('mousemove',this.onRotated),this.element.addEventListener('mouseup',this.onRotationStop,{passive:!0}),this.element.addEventListener('mouseleave',this.onRotationStop)},b.prototype.removeListeners=function(){this.listenersInstalled=!1,this.element.removeEventListener('touchstart',this.onRotationStart),this.element.removeEventListener('touchmove',this.onRotated),this.element.removeEventListener('touchend',this.onRotationStop),this.element.removeEventListener('touchcancel',this.onRotationStop),this.element.removeEventListener('mousedown',this.onRotationStart),this.element.removeEventListener('mousemove',this.onRotated),this.element.removeEventListener('mouseup',this.onRotationStop),this.element.removeEventListener('mouseleave',this.onRotationStop)},b.prototype.bind=function(){!0!==this.listenersInstalled&&this.addListeners()},b.prototype.unbind=function(){!0===this.listenersInstalled&&(this.removeListeners(),this.onRotationStop())},b.prototype.stop=function(){this.speed=0,this.onRotationStop()},b.prototype.onRotationStart=function(a){this.initDrag(),this.active=!0,this.onDragStart!==void 0&&this.onDragStart(a)},b.prototype.onRotationStop=function(){this.onDragStop!==void 0&&!0===this.active&&(this.active=!1,this.onDragStop()),this.active=!1},b.prototype.onRotated=function(a){a.preventDefault(),!0===this.active&&(a.targetTouches!==void 0&&a.targetTouches[0]!==void 0?this.lastMouseEvent={x:a.targetTouches[0].clientX,y:a.targetTouches[0].clientY}:this.lastMouseEvent={x:a.clientX,y:a.clientY})},b.prototype.update=function(a){(!this.last||8<=a-this.last)&&(this.last=a,this.lastMouseEvent!==void 0&&!0===this.active&&this.updateAngleToMouse(this.lastMouseEvent),this._angle=this.virtualAngle,this.applySpeed(),this.applyInertia(),g(this.lastAppliedAngle-this._angle)>=this.minimalAngleChange&&(this.updateCSS(),this.onRotate!==void 0&&this.onRotate(),this.lastAppliedAngle=this._angle)),window.requestAnimationFrame(this.update)},b.prototype.applySpeed=function(){0<this.inertia&&0!==this.speed&&!1===this.active&&(this.virtualAngle+=this.speed)},b.prototype.applyInertia=function(){0<this.inertia&&(g(this.speed)>=this.minimalSpeed?(this.speed*=this.inertia,this.onStop!==void 0&&!1===this.active&&g(this.speed)<this.minimalSpeed&&this.onStop()):this.speed=0)},b.prototype.getAngleToMouse=function(a){var c=this.element.getBoundingClientRect(),d={x:c.left+c.width/2,y:c.top+c.height/2};return f(a.y-d.y,a.x-d.x)+b.rightAngleInRadians},b.prototype.updateAngleToMouse=function(a){var b=this.getAngleToMouse(a);this.lastMouseAngle===void 0&&(this.lastElementAngle=this.virtualAngle,this.lastMouseAngle=b);var c=this.virtualAngle;this.mouseDiff=b-this.lastMouseAngle,this.virtualAngle=this.lastElementAngle+this.mouseDiff,this.speed=this.differenceBetweenAngles(this.virtualAngle,c)},b.prototype.differenceBetweenAngles=function(a,b){var c=a-b,d=f(Math.sin(c),Math.cos(c));return i(1e3*d)/1e3},b.prototype.initDrag=function(){this.speed=0,this.lastMouseAngle=void 0,this.lastElementAngle=void 0,this.lastMouseEvent=void 0},b.prototype.initHardwareAcceleration=function(){this.element.style.willChange='transform',this.updateCSS()},b.prototype.updateCSS=function(){this.element.style.transform='rotate('+this._angle+'rad) '},b.radToDegMulti=57.29577951308232,b.degToRadMulti=0.017453292519943295,b.rightAngleInRadians=1.5707963267948966,c.$inject=['ColorPickerService'],d.eps=1e-5,d.deg=Math.PI/180,d.prototype={toString:function(){return'url("'+this.dataURL+'")'},get dataURL(){return'data:image/svg+xml,'+encodeURIComponent(this.svg)},get svg(){return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none"><svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice"><image width="100" height="100%" xlink:href="'+this.png+'" /></svg></svg>'},get png(){return this.canvas.toDataURL()},get r(){return 1.4142135623730951*this.size/2},paint:function(){var a,b,e,f=this.context,c=this.r,g=this.size/2,h=0,k=this.stops[h];f.translate(this.size/2,this.size/2),f.rotate(-90*d.deg),f.rotate(this.from*d.deg),f.translate(-this.size/2,-this.size/2);for(var l=0;360>l;){if(l/360+d.eps>=k.pos){do a=k,h++,k=this.stops[h];while(k&&k!=a&&k.pos===a.pos);if(!k)break;var i=a.color+''==k.color+''&&a!=k;b=a.color.map(function(a,b){return k.color[b]-a})}e=(l/360-a.pos)/(k.pos-a.pos);var m=i?k.color:b.map(function(b,c){var d=b*e+a.color[c];return 3>c?255&d:d});f.fillStyle='rgba('+m.join(',')+')',f.beginPath(),f.moveTo(g,g);var n=i?360*(k.pos-a.pos):0.5,o=l*d.deg;o=j(360*d.deg,o);var p=o+n*d.deg;p=j(360*d.deg,p+0.02),f.arc(g,g,c,o,p),f.closePath(),f.fill(),l+=n}}};e.$inject=['$element','$rootScope','ColorPickerService'];var h=angular.module('color.picker.core',[]).service('ColorPickerService',a).directive('colorPickerRotator',c).directive('colorPickerConicGradient',function(){return function(a,b){var c=b[0].offsetWidth||280;b[0].style.background=new d(c).toString()}}).component('colorPicker',{bindings:{onSelect:'&',color:'<',onColorChange:'&',mouseScroll:'<',scrollSensitivity:'<'},controller:e,template:'        <div color-picker-conic-gradient class="color-palette"></div>         <div class="rotator"              color-picker-rotator              is-disabled="$ctrl.disabled"              mouse-scroll="$ctrl.mouseScroll"              scroll-sensitivity="$ctrl.scrollSensitivity"              on-rotate="$ctrl.onRotatorDrag(angle)"              angle="$ctrl.angle">            <div class="knob"></div>        </div>         <div class="color-shadow"></div>         <button type="button" class="color" ng-click="$ctrl.onColorSelClick()"></button>     '}),k=h.name;return k});
//# sourceMappingURL=color-picker.umd.min.js.map